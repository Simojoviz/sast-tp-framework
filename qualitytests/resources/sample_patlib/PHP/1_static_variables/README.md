[//]: # (This file is automatically generated. If you wish to make any changes, please use the JSON files and regenerate this file using the tpframework.)

# Static Variables

Tags: sast, php, php_v7.4.9

Version: None

## Description

This pattern targets `static` variables. When a function terminates, its local variables are destroyed. When we run that function again, new local variables will be allocated. If we want to keep one of those variables alive, we can use the `static` keyword. Static variables may be challenging for SAST tools: is a SAST tool considering a static variable used in a function as alive?

## Overview

| Instances                 | has discovery rule   | discovery method   | rule successfull   |
|---------------------------|----------------------|--------------------|--------------------|
| [1 Instance](#1-instance) | yes                  | joern              | yes                |

## 1 Instance

### Code

```php
<?php

function F($a){
    static $b = 'abc'; // tarpit
    echo $b; // sink (moved out from standard skeleton)
    $b = $a;
}

$a = $_GET["p1"];  // source
F($a); // print "abc"
F('abc'); // print value of $_GET["p1"]
```

### Instance Properties

| category   | feature_vs_internal_api   | input_sanitizer   | negative_test_case   | source_and_sink   |
|------------|---------------------------|-------------------|----------------------|-------------------|
| S0         | FEATURE                   | no                | no                   | no                |

<details markdown="1">
<summary>
<b>More</b></summary>

<details markdown="1">
<summary>

### Compile

</summary>

```bash
$_main: ; (lines=13, args=0, vars=1, tmps=5)
    ; (before optimizer)
    ; /home/user/gitlab/static-tools---latex/paper_code/PHP/Testability_Patterns/1_static_variables/1_static_variables.php:1-11
L0 (9):     EXT_STMT
L1 (9):     T1 = FETCH_R (global) string("_GET")
L2 (9):     T2 = FETCH_DIM_R T1 string("p1")
L3 (9):     ASSIGN CV0($a) T2
L4 (10):    EXT_STMT
L5 (10):    INIT_FCALL 1 128 string("f")
L6 (10):    SEND_VAR CV0($a) 1
L7 (10):    DO_FCALL
L8 (11):    EXT_STMT
L9 (11):    INIT_FCALL 1 128 string("f")
L10 (11):   SEND_VAL string("abc") 1
L11 (11):   DO_FCALL
L12 (11):   RETURN int(1)

F: ; (lines=10, args=1, vars=2, tmps=1)
    ; (before optimizer)
    ; /home/user/gitlab/static-tools---latex/paper_code/PHP/Testability_Patterns/1_static_variables/1_static_variables.php:3-7
L0 (3):     EXT_NOP
L1 (3):     CV0($a) = RECV 1
L2 (4):     EXT_STMT
L3 (4):     BIND_STATIC (ref) CV1($b)
L4 (5):     EXT_STMT
L5 (5):     ECHO CV1($b)
L6 (6):     EXT_STMT
L7 (6):     ASSIGN CV1($b) CV0($a)
L8 (7):     EXT_STMT
L9 (7):     RETURN null
```

</details>

<details markdown="1">
<summary>

### Discovery

</summary>

The `BIND_STATIC` opcode is only for static variables that are normally used inside code blocks. The SAST tools may not able to keep the proper values for these static variables. As such the discovery rule should be accurate as it is

```scala
val start_line = (name, "1_static_variables_iall", cpg.call(".*BIND_STATIC.*").location.toJson);
```

| discovery method   | expected accuracy   |
|--------------------|---------------------|
| joern              | Perfect             |

</details>

<details markdown="1"open>
<summary>

### Measurement

</summary>

| Tool        | masked_tool   | tool2   | Ground Truth   |
|-------------|---------------|---------|----------------|
| 01 Jan 1970 | no            | no      | yes            |
| 01 Jan 2023 | yes           | yes     | yes            |

</details>

<details markdown="1">
<summary>

### Remediation

</summary>

Likely this tarpit should be solved at the SAST tool side. Transforming a static variable into a non-static one is unfeasible. It is unclear how to create a modeling rule for the static keyword.

</details>

</details>
